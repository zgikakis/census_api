import requests
import pandas as pd
from IPython.display import FileLink

# Variables
year = 2020
columns = "I_COMMODITY,I_COMMODITY_SDESC,I_COMMODITY_LDESC,CTY_CODE,CTY_NAME,GEN_VAL_YR,GEN_QY1_YR,UNIT_QY1"
commodity_code = "2615906030" #10digit HS code

#function to fetch data through API
def fetch_census_trade_data():
    #base url
    url = "https://api.census.gov/data/timeseries/intltrade/imports/hs"
    
    params = {
        "get": columns,
        "time": f"{year}-12",
        "I_COMMODITY": {commodity_code}
    }
    
    try:
        response = requests.get(url, params=params)
        response.raise_for_status()
        data = response.json()
        return data
    
    except requests.exceptions.HTTPError as http_err:
        print(f"HTTP error occurred: {http_err}")
    except Exception as err:
        print(f"An error occurred: {err}")

# call function
if __name__ == "__main__":
    census_data = fetch_census_trade_data()

# convert to pandas dataframe
df = pd.DataFrame(census_data[1:], columns=census_data[0])
# drop last column, which is redundant
df = df.iloc[:, :-1]

#print(df)
